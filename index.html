<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WaxAlert</title>

  <!-- Bangers font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">

  <!-- PWA -->
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="theme-color" content="#0b0b0b">

  <style>
    :root { --navH: 62px; --radius: 14px; }
    html, body { height: 100%; }
    body {
      margin:0;
      font-family:Arial,sans-serif;
      background:#0b0b0b;
      color:#fff;
    }

    .content {
      padding:16px 16px calc(var(--navH) + 18px);
      max-width:900px;
      margin:0 auto;
    }

    .card {
      background:rgba(255,255,255,0.08);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:16px;
      padding:16px;
    }

    /* v18 Title */
    .appTitle {
      font-family: "Bangers", cursive;
      font-size: 28px;
      text-align: center;
      letter-spacing: 1px;
      margin-bottom: 6px;
    }
    .appTitle .big {
      font-size: 34px;
    }

    .heroText {
      font-size:16px;
      line-height:1.4;
      opacity:0.9;
      text-align: center;
      margin-bottom: 12px;
    }

    .small { opacity:.7; font-size:12px; }
    .spacer { height:12px; }

    .searchWrap { position: relative; width: 100%; }
    .searchIcon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      opacity: 0.75;
      pointer-events: none;
    }

    input {
      width:100%;
      box-sizing:border-box;
      padding:12px 12px 12px 40px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.16);
      background:#111;
      color:#fff;
      font-size:16px;
      outline:none;
    }

    button.primary {
      width:100%;
      margin-top:10px;
      padding:12px;
      border:0;
      border-radius:12px;
      background:#fff;
      color:#000;
      font-weight:700;
      cursor:pointer;
    }

    .list { margin-top:12px; display:grid; gap:10px; }
    .suggestion { cursor:pointer; }
    .suggestion .title { font-weight:700; }

    .bottomNav {
      position:fixed;
      left:0; right:0; bottom:0;
      height:var(--navH);
      background:#0b0b0b;
      border-top:1px solid rgba(255,255,255,0.12);
      z-index:9999;
      display:flex;
      justify-content:center;
    }

    .bottomNavInner {
      width:100%;
      max-width:900px;
      padding:10px 16px max(10px, env(safe-area-inset-bottom));
      box-sizing:border-box;
    }

    .navBtn {
      width:100%;
      height:42px;
      border:0;
      border-radius:14px;
      background:rgba(255,255,255,0.12);
      color:#fff;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .navIcon { width:22px; height:22px; }

    .kv {
      display:grid;
      grid-template-columns:1fr auto;
      gap:10px;
      padding:10px 0;
      border-bottom:1px solid rgba(255,255,255,0.10);
    }
    .kv:last-child { border-bottom:0; }
    .k { opacity:.85; }
    .v { font-weight:700; text-align:right; }
  </style>
</head>

<body>
  <main class="content">
    <section>
      <div class="card">

        <!-- v18 centered branded title -->
        <div class="appTitle">
          <span class="big">W</span>ax
          <span class="big">A</span>lert
        </div>

        <div class="heroText">
          Real-time box prices. Zero guesswork.
        </div>

        <div class="searchWrap">
          <svg class="searchIcon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z"
              stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M16.8 16.8 21 21"
              stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <input id="q" placeholder="What box are you searching for?" />
        </div>

        <div class="list" id="suggestions"></div>
        <button class="primary" id="btnSearch">Search</button>
        <div class="small" id="selectedProduct"></div>
      </div>

      <div class="list" id="results"></div>
    </section>
  </main>

  <nav class="bottomNav">
    <div class="bottomNavInner">
      <button class="navBtn" id="btnHome" aria-label="Home">
        <svg class="navIcon" viewBox="0 0 24 24" fill="none">
          <path d="M3 10.5L12 3l9 7.5"
            stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M5 9.8V21h14V9.8"
            stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M10 21v-7h4v7"
            stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </nav>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxN9m7gStD_HgnOGSfjJzp7T9GQiYVhlMItgo5_YzUFe3Vrwe_GOsTVD0pndnnhk7a2MA/exec";
    const APP_VERSION = "v18";

    function normalize(s){ return String(s||"").toLowerCase(); }
    function escapeHTML(s){
      return String(s ?? "").replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[m]));
    }

    const qInput = document.getElementById("q");
    const suggestionsEl = document.getElementById("suggestions");
    const resultsEl = document.getElementById("results");
    const selectedEl = document.getElementById("selectedProduct");

    let PRODUCT_CATALOG = [];
    let SELECTED_PRODUCT = null;

    async function api(action,payload){
      const r = await fetch(API_URL,{
        method:"POST",
        headers:{ "Content-Type":"text/plain;charset=utf-8" },
        body:JSON.stringify({ action, payload })
      });
      const t = await r.text();
      try { return JSON.parse(t); } catch { return { ok:false }; }
    }

    async function loadCatalog(){
      const d = await api("products",{});
      PRODUCT_CATALOG = d?.products || [];
    }

    function renderSuggestions(list){
      suggestionsEl.innerHTML = list.slice(0,10).map(p => `
        <div class="card suggestion" data-code="${escapeHTML(p.code)}">
          <div class="title">${escapeHTML(p.displayName)}</div>
        </div>`).join("");
    }

    qInput.addEventListener("input",()=>{
      const t = normalize(qInput.value);
      if (!t) { suggestionsEl.innerHTML=""; return; }
      renderSuggestions(PRODUCT_CATALOG.filter(p =>
        normalize(p.displayName + " " + p.keywords).includes(t)
      ));
    });

    loadCatalog();
  </script>
</body>
</html>
